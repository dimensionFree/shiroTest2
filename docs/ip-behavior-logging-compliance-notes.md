# IP 与用户行为日志合规记录（待后续实施，2026-02-22）

> 撰写时间：2026-02-22

## 1. 背景与当前状态

当前系统已经具备以下能力：

- 记录阅读行为与小人互动行为（如 `tap`、`flick`）
- 记录来源 IP
- 记录 IP 解析后的地理信息（国家/省市等）
- 小人互动已引入“Redis 一分钟聚合后入库”的降频策略（按 IP + 类型聚合）

当前决策状态：

- 先不调整“IP 长期留存”实现
- 先不新增隐私政策页面
- 先完成业务功能，合规与数据治理后续统一处理

## 2. 风险共识（针对小型个人网站）

即使是低流量个人站，也存在以下风险：

- 长期保存明文 IP + 行为时间线，可能形成可关联到个人的轨迹
- 若发生泄露或投诉，无法说明“最小必要保存”的合理性
- 未来接入登录、AI 聊天后，数据敏感度会进一步上升

说明：

- “未公开展示”并不等于“无风险”
- “别人也没写 privacy”并不构成合规依据

## 3. 已讨论的可选治理方案

### 方案 A（最低成本，推荐优先）

- 明文 IP 仅短期保留（建议 30 天）
- 到期后仅保留：
  - `ip_hash`（不可逆）
  - 国家/省/市
  - 行为类型与统计维度
- 补充简版隐私说明页（采集项、用途、保存期、联系方式）

优点：

- 改动小、风险明显下降
- 不影响行为统计

### 方案 B（长期保留明文 IP 的降风险版本）

- 明文 IP 加密存储（避免裸明文）
- 严格权限隔离（默认不展示，按需审计访问）
- 明确长期留存目的与时长
- 提供删除/导出响应机制

优点：

- 保留排障能力

缺点：

- 合规与运维成本显著高于方案 A

### 方案 C（维持现状）

- 不新增声明
- 不做脱敏与清理

风险：

- 法务解释能力最弱
- 事故暴露成本最高

## 4. 对 CHAT 类型的特殊约束（预留）

当前已在实现中保留注释约束：

- `AVATAR`（tap/flick）可按分钟聚合
- `CHAT` 类型未来应逐条记录，不应按“每 IP 每分钟一条”合并

后续落地时需单独定义：

- CHAT 保存期限
- CHAT 展示权限
- CHAT 导出/删除策略

## 5. 后续执行清单（暂不实施）

当决定启动治理时，按以下顺序执行：

1. 增加隐私说明页面（先最小可用版本）
2. 增加数据保留策略配置（IP 明文保留天数）
3. 增加定时清理/脱敏任务
4. 增加后台权限控制与访问审计
5. 为 CHAT 类型追加独立策略与文档

## 6. 本文档用途

本文档用于记录当前阶段的“已知风险与延后决策”，便于后续快速恢复合规改造工作；不代表现阶段已完成相关治理。
